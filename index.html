<script>
  const btn = document.getElementById('mintBtn');
  const status = document.getElementById('status');

  btn.onclick = async () => {
    if (!window.ethereum) return status.textContent = "Install MetaMask";

    try {
      status.textContent = "Connecting...";
      await window.ethereum.request({ method: "eth_requestAccounts" });

      const provider = new ethers.BrowserProvider(window.ethereum);
      const network = await provider.getNetwork();
      if (Number(network.chainId) !== 137) {
        await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: "0x89" }] });
      }

      const signer = await provider.getSigner();
      const contract = new ethers.Contract(
        "0x8963a229A573dC75ec5963e78E33732C6BE92C25",
        ["function publicMint(uint256 amount) public payable"],
        signer
      );

      // ТОЧНО 0.003 MATIC + 1 wei (чтобы не было округления вниз)
      const price = ethers.parseUnits("0.003", "ether") + 1n;

      status.textContent = "Sending transaction...";
      const tx = await contract.publicMint(1, { value: price });
      status.textContent = "Waiting for confirmation...";
      await tx.wait();

      status.textContent = `Minted! Tx: ${tx.hash.slice(0,10)}...`;
    } catch (err) {
      status.textContent = err.shortMessage || err.message || "Rejected";
    }
  };
</script>
